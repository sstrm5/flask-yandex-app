{% extends "base.html" %}

{% block content %}
    <a href="/news/create" class="btn btn-primary mb-3">Добавить</a>
    <table>
        <thead>
            <tr>
                <th>Заголовок</th>
                <th>Текст</th>
                <th>Автор</th>
                <th>Опубликовано</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for news_item in news %}
            <tr>
                <td>{{ news_item.title }}</td>
                <td>{{ news_item.text }}</td>
                <td>Автор</td>
                <td>
                    <input type="checkbox" name="is_published" 
                           {% if news_item.is_published %}checked{% endif %}
                           onchange="updatePublicationStatus({{ news_item.id }}, this.checked)">
                </td>
                <td>
                    <button onclick="location.href='/news/edit/{{ news_item.id }}'">Редактировать</button>
                    <button onclick="location.href='/news/delete/{{ news_item.id }}'">Удалить</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function updatePublicationStatus(newsId, isPublished) {
            fetch(`/news/update-status/${newsId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}' // Для защиты от CSRF-атак
                },
                body: JSON.stringify({ is_published: isPublished })
            })
            .then(response => {
                if (!response.ok) {
                    alert('Ошибка при обновлении статуса публикации.');
                }
            })
            .catch(error => {
                console.error('Ошибка:', error);
                alert('Произошла ошибка при обновлении статуса.');
            });
        }
    </script>
{% endblock %}